# Crocodile 任务调度系统.v3


## 特性
- 多种任务类型:
    - 执行`http`请求任务
    - 运行`shell`、`python`、`golang`代码任务
- 父、子任务: 
    当设置了父任务或者子任务后，先会运行`父任务`->`主任务`->`子任务`，任意任务出错后会立即中断整个流程，还可以设置父任务或子任务`并行`或者`串行`运行
- 调度算法:  
    支持四种调度算法`随机`、`轮训`、`Worker权重`、`Worker最少任务数`来调度Worker运行任务，
- 自定义报警策略:  
    可以设置当`任务成功`、`失败`、或者`运行完成后`报警给多个用户  
    设置任务的`返回码`或者`返回内容`来比较任务的`实际返回码`或者`返回内容`是否相同来判断任务运行成功或者，code任务默认为0，http任务默认为200  
- 在Web节点对任务进行增加、修改删除、克隆、删除任务等操作
- 实时查看`正在运行`的任务和任务的`实时日志`，并且可以对正在运行的任务进行`终止`操作
- 主机组:  
    一个任务只可以绑定到任意一个主机组，任务的运行会通过任务的路由策略来选取这个主机组中的一个任务来运行任务
- 主机:  
    一个主机组可以绑定多个主机，主机是实际运行任务的节点,注册后调度中心自动发现
- 安全策略  
    使用tls来进行调度之间数据加密  
    设置`访问令牌`来确保正常通讯
- 任务的日志管理，清理日志
- 报警通知支持平台  
    邮件  
    企业微信  
    钉钉  
    Slack Channel   
    Telegram Bot
    WebHooks
- 详细的任务审计功能  
    对用户的所有对数据改变改变的操作都会记录下来
- 权限控制  
    有三种用户类型
    - 管理员  
        拥有所有操作权限，
    - 普通用户
        可以创建新的任务、主机组,但是只可以自已创建的任务或主机组进行操作，但是不能查看审计记录、所有用户
    - 访客  
        只有查看的权限、无任何操作修改权限，但是不能查看审计记录、所有用户


# TODO
- [x] 用户管理  
      普通用户、管理员
- [x] 主机组管理
- [x] 主机管理
- [x] rpc调度任务执行
- [x] 调度任务采用tls加密、token认证
- [x] 任务操作[增加、删除、更新、查询、暂停调度]
- [x] 保存执行日志
- [x] 实现两种task Run 接口
- [x] 手动触发任务、终止任务、获取任务日志
- [x] 使用golint检测代码
- [x] 删除主机，暂停主机运行任务
- [x] 运行任务流式返回数据
- [x] 实时在线日志后端接口 
    - 任务执行结果需要流式的返回 
    - 运行任务重写
- [x] 在一个任务中保存父子主任务的状态
- [x] 平滑退出
- [x] 调度算法
    - 随机
    - 最少任务数
    - 权重
    - 轮询执行
- [x] 报警
    - 配置告警模式，任务失败、成功 时报警
    - 通过检测返回结果、状态码，来判断是否报警，默认只检查返回码。
    - 报警方式: email,telegram,slack,钉钉,webhooks，
- [x] 支持语言`shell`,`golang`,`python`
- [x] Swagger API
- [x] 返回统计总数
- [x] 模糊搜索，查看自已创建的任务
- [x] 任务克隆
- [x] 获取正在运行的任务(`websocket`)
- [x] 操作审计
- [x] 前端
- [ ] ldap支持
- [ ] `Prometheus`+`grafana` 监控
- [ ] 压力测试
- [ ] 调度中心集群